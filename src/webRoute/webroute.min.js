!function(){function a(){this.$get=["$controller",function(a){return{$resolveController:function(){return a}}}]}function b(){function a(a){var b=a.split("/").splice(1),c="/(\\w+)",d={},e=0;for(var f in b)b[f].indexOf(":")>-1?(d[b[f].replace(":","")]=null,b[f]=c):b[f]&&e>0&&(b[f]="/"+b[f]),e++;return{params:d,regexp:new RegExp("^/(?:"+b.join("")+")$"),paramsLength:Object.keys(d).length}}var b={},c=["template","templateUrl","jController"];this.setState=function(d,e){if(e.route=a(e.url),e.route.name=d,e.parent&&b[e.parent]){var f=b[e.parent];e.views={};for(var g in f.views)if(g!==e.targetView)e.views[g]=f.views[g];else{e.views[g]={};for(var h=c.length;h--;)e[c[h]]&&(e.views[e.targetView][c[h]]=e[c[h]],delete e[c[h]])}f=null,e.route.parent=e.parent,delete e.parent}return b[d]=e,this},this.$get=function(){return b}}function c(){var a;return this.fallBack=function(b){a=b},this.$get=["$jEliWebStateProvider",function(b){function c(a){var c;for(var d in b){var e=b[d];e.route.regexp.test(a)&&(c=e)}return{get:function(){return c},checkParams:function(){if(c&&c.route.paramsLength){var b=c.route.regexp.exec(a).splice(1),d=0;for(var e in c.route.params){var f=b[d],g=parseInt(f);c.route.params[e]=isNaN(g)?f:g,d++}}return c}}}var d=0;return{getRoute:function(a){if(d>2)return d=0,!1;var b=c(a).checkParams();return b?b:void location.replace("#"+this.getFallBack())},getAllRoute:function(){return b},getParentRoute:function(a){return jEli.$extend({},b[a]||{})},getFallBack:function(){return a},isLoaded:!1}}],this}function d(a){var b=null,c=null;return this.go=function(a,b){return location.hash=this.$href(a,b),this},this.search=function(a){return window.location.search=a},this.$href=function(b,c){var d=a[b];if(d){var e=d.url.replace(/\:(\w)+/g,function(a,b){var d=a.split(":")[1];return d in c&&c[d]?c[d]:a});return e}},this.state={route:{params:{}}},this.replaceWebState=function(a){(b||a)&&(b={state:"replaceState",hash:"#"+(a||b.previousHash).replace(/^#/,""),previousHash:c,currentLocation:location.hash},jEli.dom(window).triggerHandler("$locationReplaceState"),c=b.hash)},this.$stateChanged=function(a){return this.state.url!==a},this.getRootUrl=function(){var a=document.location.protocol+"//"+(document.location.hostname||document.location.host);return document.location.port&&(a+=":"+document.location.port),a+="/"},this.currentState=function(a){return jEli.$isUndefined(a)?b:void(b=a)},this}function e(a){return{allowType:"AE",$init:function(b,c,d){b.bind("click",function(b){var e=c.where.split(":"),f=e.shift(),g={};e.length&&(g=jEli.$stringToObject(e.join(":"),d)),a.go(a.$href(f,g))})}}}function f(a,b,c,d,e,f){function g(a,b,c){n[o]={ele:a,attr:b,model:c,previousModel:null,previousLoaded:!1}}function h(a){return function(b){return b?n[a][b]:n[a]}}function i(a){var b=c.currentState();p=!0,(b.hash!==b.previousHash||r)&&(location.replace(b.hash),q=b.currentLocation,r=!1)}function j(a){if(!location.hash.length)return!1;var b=c.currentState();return p?(q!==location.hash&&location.hash!==b.hash&&(r=!0,p=!1,m(k())),!1):void m(k())}function k(){var a=l();return a&&a.indexOf("#")>-1?a.replace("#",""):a}function l(){return p?q:location.hash}function m(a){function g(){if(i(),s.$broadcast("$webRouteSuccess",[]),j(),p.template){var a=q.model.$new();p.jController&&f.$resolveController().instantiate(p.jController,a,p.jResolver,p.jControllerAs),q.ele.empty().append(p.template).compile(a),a.$publish("$viewContentLoaded")(q.ele),q.previousModel=a}}function i(){c.state=n,c.state.route.$model=q.model,c.$$baseUrl=a}function j(){var a=h(o)("previousModel");a&&a.$$destroy({message:"View changed"})}function k(){return n.views?n.views[o]:n}function l(a,b){c.$stateChanged(a)&&(b.targetView&&h(b.targetView)()&&(o=b.targetView),!o||b.targetView||b.views||(o=""))}var m=jEli.$extend({},c.state.route),n=d.getRoute(a);if(n){l(a,n);var p=k(),q=h(o)();s=new jEli.jEvents("addEventListener",function(a){jEli.$isEqual("$webRouteStart",a.type)&&(p.templateUrl?b.get(p.templateUrl).done(function(a){p.template=a.data,g()}):p.template&&g())}),s.addEventListener("$webRouteStart",function(a){e.$publish(a.type)(a,n.route,n.data)}),s.addEventListener("$webRouteSuccess",function(a,b){e.$publish(a.type)(a,n,n.route.params,m,m.params||m.route.params)}),s.$broadcast("$webRouteStart",[])}}var n={},o="",p=!1,q=location.hash,r=!1,s=null;return"onhashchange"in window&&(d.isLoaded||(d.isLoaded=!0,jEli.dom(window).bind("hashchange",j).on("$locationReplaceState",i),location.hash=location.hash||d.getFallBack())),{allowType:"AE",$compiler:function(a,b){return function(a,b,c){o=b.jView||b.ref||"",g(a,b,c),m(k())}}}}jEli.jModule("jEli.web.route",[]).jProvider("$jviewResolver",a).jProvider("$jEliWebProvider",c).jProvider("$jEliWebStateProvider",b).jFactory("$webState",["$jEliWebStateProvider",d]).jElement("jView",["$jCompiler","$http","$webState","$jEliWebProvider","$rootModel","$jviewResolver",f]).jElement("go",["$webState",e])}({});