!function(){"use strict";function a(){}function b(){var b=(new a).createVirtualElement(document.body,"div",{height:"1in",left:"-100%",width:"1in"}),c=window.devicePixelRatio||1,d={dpi_x:b.offsetWidth*c,dpi_y:b.offsetHeight*c};return document.body.removeChild(b),d}function c(a,b){this.options=u,this.svgData=this.getSvgContent(a),this.svg=new Blob([this.svgData],{type:"image/svg+xml;charset=utf-8"}),b&&this.createDummySvg(this.svgData),this.blobURL=this.options.domUrl.createObjectURL(this.svg),this.svgBase64Data=this.toBase64()}function d(b){this.canvasCreated=[],this.options=u,this.pages=b||{},this.browser=new a}function e(a){var b,c={};return"string"==typeof a?b=document.querySelectorAll(a):"[object NodeList]"===toString.call(a)?b=a:c=a,b&&h(b,function(a,b){c[b]=a}),c}function f(){this.queue=[],this._done=[],this._fail=[]}function g(a){var b=document.styleSheets,c={};for(var d in b){var e=b[d].rules||b[d].cssRules;for(var f in e)p(a,e[f].selectorText,a.parentNode)&&(c=l(c,j(e[f].style),k(a)))}return c}function h(a,b){for(var c=a.length,d=0;c>d;)(b||function(){})(a[d],d),d++}function i(a,b){var c={};if("object"!=typeof b||!a)throw new error("extractAttr : requires list of attr to extract");return b.forEach(function(b){c[b]=a.getAttribute(b)}),c}function j(a){var b={};if(!a)return b;if(a instanceof CSSStyleDeclaration)for(var c=a.length;c--;)b[a[c].toLowerCase()]=a[a[c]];else if("string"==typeof a){a=a.split("; ");for(var d in a){var e=a[d].split(": ");b[e[0].toLowerCase()]=e[1]}}return b}function k(a){var b={};if(a.nodeType===document.ELEMENT_NODE){var c=a.getAttribute("style");if(c){var d=c.split(";");for(var e in d){var f=d[e].split(":");b[f[0]]=f[1]}}}return b}function l(a,b,c){if(c)return l(l(a,b),c);for(var d in b)a.hasOwnProperty(d)||(a[d]=b[d]);return a}function m(a,b){if(a&&b)for(var c in b)a.style[c]=b[c]}function n(a){return["radio","checkbox"].indexOf(a.getAttribute("type"))>-1}function o(a,b){var c=a.ownerDocument.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),e=c.nextNode();do if(e){var f=e.tagName;switch(f.toLowerCase()){case"img":var h={height:e.clientHeight,width:e.clientWidth},i=d.prototype.generateCanvas(h),j=i.getContext("2d");j.drawImage(e,0,0),e.src=i.toDataURL();break;case"textarea":e.textContent=e.value;break;case"input":n(e)?e.checked?e.setAttribute("checked",""):e.removeAttribute("checked"):e.setAttribute("value",e.value)}(b||function(){})(e,g(e))}while(e=c.nextNode())}function p(a,b,c){var d=(c||document).querySelectorAll(b),e=!1;return h(d,function(b){b===a&&(e=!0)}),e}function q(b){function c(){document.body.removeChild(e)}var d=b.cloneNode(!0),e=(new a).createVirtualElement(document.body,"div");return e.appendChild(d),{content:d,destroy:c,width:d.clientWidth,height:d.clientHeight}}function r(b,c){this.pages={},this.builder=new d,this.styleSheet=[];var e="A4",f=96,g={1:{top:96,left:72,right:72,bottom:10},_:{top:72,left:72,right:72,bottom:10}};this.paper=function(a){return h[a]&&(a=a),this},this.getPaperSize=function(b){var c=a.prototype.support.deviceRatio();return h[e][c.dpi_x]?h[e][c.dpi_x]:h[e][b||f]},this.extendPaperAspect=function(a,b,c){return h[a]||(h[a]={}),h[a][b]=c,this},this.dpiFallback=function(a){return h[e][a]&&(f=a),this},this.paperMargin=function(a){return"object"==typeof a&&(g=l({},g,a)),this},this.getPaperMargin=function(a){return a?g[a]||g._:g};var h={};h.A4={72:{width:595,height:842},96:{width:794,height:1123},150:{width:1240,height:1754},300:{width:2480,height:3508}},h.A5={72:{width:420,height:595},96:{width:595,height:794},150:{width:874,height:1240},300:{width:1748,height:2480}},h.A1={72:{width:1684,height:2384},96:{width:2245,height:3179},150:{width:3508,height:4967},300:{width:7016,height:9933}},h.A2={72:{width:1191,height:1684},96:{width:1587,height:2245},150:{width:2480,height:3508},300:{width:4960,height:7016}},h.A3={72:{width:842,height:1191},96:{width:1123,height:1587},150:{width:1754,height:2480},300:{width:3508,height:4960}},b&&this.loadTemplate(b,c)}function s(){this.afterLoadevents.forEach(function(a){var b=document.querySelectorAll("["+a+"]");if(b.length)for(var c=0;c<b.length;){var d=b[c].getAttribute(a),e=a.split("-")[2];b[c].addEventListener(e,r.prototype.eventHandler(d),!1),c++}})}function t(a,b){return a.replace(/\{\{(.*?)\}\}/g,function(a,c){return b[c]||a})}var u={paperHeight:1319,paperWidth:1019,domUrl:window.URL||window.webkitURL||window};a.prototype.createVirtualElement=function(a,b,c){var d=document.createElement(b);if(d.style.zIndex="-10000",d.style.position="absolute",d.style.top="-100000",d.style.visibility="hidden",c)for(var b in c)d.style[b]=c[b];return a.appendChild(d),d},a.prototype.support={testSVG:function(){var a=new Image,b=document.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(a){return!1}return!0},testCORS:function(){return"undefined"!=typeof(new Image).crossOrigin},deviceRatio:b},a.prototype.getPageStyleSheets=function(){for(var a=document.styleSheets,b=[],c=a.length,d=0;c>d;){var e=a[d].rules;if(e.length)for(var f=0;e.length>f;)!b.indexOf(e[f].cssText)>-1&&b.push(e[f].cssText),f++;d++}return b.join("")},c.prototype.getBlobURL=function(){return this.blobURL},c.prototype.revokeBlobURL=function(){this.options.domUrl.revokeObjectURL(this.blobUrl)},c.prototype.createDummySvg=function(b){if(b){var c=(new a).createVirtualElement(document.body,"div");c.innerHTML=b,this.destroyDummySVG=function(){document.body.removeChild(c)},this.getDummySVG=function(){return c.querySelector("svg")}}return this},c.prototype.serializeSVG=function(a){return this.svgData=(new XMLSerializer).serializeToString(a),this.svg=new Blob([this.svgData],{type:"image/svg+xml;charset=utf-8"}),this.blobURL=this.options.domUrl.createObjectURL(this.svg),this.svgBase64Data=this.toBase64(),this},c.prototype.getSvgContent=function(a){var b=this.options.paperWidth,c=this.options.paperHeight,d=document.createElement("div");if("string"!=typeof a){var e=q(a);o(e.content,function(a,b){m(a,b)}),a=document.body===a?e.content.innerHTML:e.content.outerHTML,e.destroy(),b=e.width,c=e.height}return d.innerHTML=a,a=(new XMLSerializer).serializeToString(d),'<svg xmlns="http://www.w3.org/2000/svg" width="'+b+'" height="'+c+'"><foreignObject width="100%" height="100%">'+a+"</foreignObject></svg>"},c.prototype.toBase64=function(){var a="data:image/svg+xml;base64,";return a+=btoa(unescape(encodeURIComponent(this.svgData)))},c.prototype.close=function(){this.revokeBlobURL(this.blobURL),this.destroyDummySVG&&this.destroyDummySVG(),this.svgData=null,this.svgBase64Data=null},d.prototype.captureScreenToCanvas=function(a,b,d){var e=b.getContext("2d"),f=new c(a,!0),g=b.clientHeight,h=b.clientWidth,i=this.createImage({width:h,height:g},function(){e.drawImage(this,0,0),f.close()});return function(a){i.src(f.svgBase64Data),(a||function(){})()}},d.prototype.generateCanvas=function(a){var b=document.createElement("canvas");for(var c in a)b.setAttribute(c,a[c]);return b},d.prototype.captureScreen=function(a){var b=new c(a,!0),d=this.convertSVG2Canvas(b.getDummySVG(),function(){b.close(),b=null});return{appendTo:function(a){return a&&d.appendTo(a),this},getBase64:function(){return d.getBase64.apply(d.getBase64,arguments)}}},d.prototype.setPageData=function(a,b){return b&&(this.pages[a]=b),this},d.prototype.drawPagesCanvas=function(a,b,c){function d(a){return function(b){h[a]=b,k++,k===Object.keys(j).length&&i.resolve(h)}}var g=this,h={},i=new f,j=e(this.pages),k=0;for(var l in j){var m=j[l];"[object Array]"===toString.call(m)&&(m=m.join(""));var n=g.captureScreen(m).appendTo(a);n.getBase64(b,c).done(d(l))}return i},d.prototype.drawPagesImage=function(a,b,d){var g=this,h={},i=e(this.pages),j=new f,k=0;for(var l in i){k++;var m=i[l];"[object Array]"===toString.call(m)&&(m=m.join(""));var n=this.createImage({width:g.options.paperWidth,height:g.options.paperHeight}),o=new c(m,!0);o.serializeSVG(o.getDummySVG());n.src(o.svgBase64Data),h[l]=o.toBase64(b,d),a&&a.appendChild(n.get()),o.close(),o=null,k===Object.keys(i).length&&j.resolve(h)}return j},d.prototype.createImage=function(a,b){var c=new Image;if(a)for(var d in a)c.setAttribute(d,a[d]);return this.browser.support.testCORS()&&(c.crossOrigin="Anonymous"),c.onload=b||function(){},{src:function(a){return c.src=a,this},get:function(){return c},onComplete:function(a){if(c.complete||void 0===c.complete)return(a||function(){})(c)}}},d.prototype.helpers={getElementCss:g,writeElementStyle:m,extend:l,extractStyle:k,transverseDom:o,is:p,promise:f,forEach:h},f.prototype={then:function(a,b){return this._done.push(a),this._fail.push(b),this},catch:function(a){return this._fail.push(a),this},done:function(a){return this._done.push(a),this},fail:function(a){return this._fail.push(a),this},resolve:function(){for(var a=this._done.length;a--;){var b=this._done.shift();b.apply(b,arguments)}},reject:function(){for(var a=this._fail.length;a--;){var b=this._fail.shift();b.apply(b,arguments)}}},d.prototype.calculatePaperSize=function(a,b){for(var c=Math.ceil(a.clientHeight/this.paperHeight),d=0;d<c;d++)this.canvasCreated.push(this.generateCanvas(idtext+"_"+d));return this},d.prototype.pageManager=r,r.prototype.createElement=function(a,b){var c=document.createElement(a.element);if(b=b||{},a.attr)for(var d in a.attr)c.setAttribute(d,a.attr[d]);if(a.text&&(c.innerHTML=t(a.text,b)),a.eventListener)for(var e in a.eventListener)c.setAttribute("data-event-"+e,a.eventListener[e]),this.events.afterLoadevents.push("data-event-"+e);if(a.children)for(var f in a.children)c.appendChild(r.prototype.createElement(a.children[f],b));return c},r.prototype.eventHandler=function(a){return this.events.handlers[a]||function(){}},r.prototype.events={handlers:{},afterLoadevents:[],bindListeners:s},r.prototype.loadTemplate=function(a,b){if(a){var c=new XMLHttpRequest;c.open("GET",a,!1),c.onreadystatechange=function(){if(4===c.readyState&&(200===c.status||0==c.status)){var a,d=c.responseText;try{a=JSON.parse(d)}catch(a){throw new error("Inavlid Json file received")}finally{a&&(b||function(){})(a)}}},c.send(null)}},r.prototype.setPage=function(a){function b(a){function b(b){return function(d,e){return a[b]=t(d,e),c}}var c=this;for(var d in a)this["set"+d]=b(d)}return this.pages[a]||(this.pages[a]={header:null,footer:null,body:null}),new b(this.pages[a])},r.prototype.addStyle=function(a){return a&&this.styleSheet.push(a),this},r.prototype.buildPages=function(a,b){function c(a,b){return"function"==typeof a?a.apply(a,[b]):a}function d(a,b,c){var d=document.createElement("style");d.textContent=a,d.setAttribute("id","jPageBuilder_"+c),d.setAttribute("type","text/css"),b.appendChild(d)}function e(b,e){var g=document.createElement("div"),h="",i=f.getPaperMargin(b);for(var j in i)g.style["padding-"+j]=i[j]+"px";g.setAttribute("id","jPageBuilder_"+b);var k=f.getPaperSize();for(var l in k)g.style[l]=k[l]+"px";var m=["header","body","footer"];for(var n in m)e[m[n]]&&(h+=c(e[m[n]],k));return h&&("string"==typeof h?g.innerHTML=h:g.appendChild(h)),function(){f.styleSheet.length&&f.styleSheet.forEach(function(a,b){d(a,g,b)}),f.builder.setPageData(b,g),a&&a.appendChild(g)}}var f=this,g=[];for(var h in this.pages)g.push(e(h,this.pages[h]));var i=0;return g.forEach(function(a){i++,a(),g.length===i&&b&&b.apply(b,[g.length])}),g=[],this},d.prototype.convertSVG2Canvas=function(a,b){if(!a)throw new error("convertSVG2Canvas : Requires SVG element.");var d=new c("").serializeSVG(a),e=new f,g=i(a,["width","height"]),h=this,j=h.generateCanvas(g);return this.createImage(g,function(){try{var a=j.getContext("2d");a.fillStyle="#fff",a.fillRect(0,0,g.width,g.height),a.drawImage(this,0,0),e.resolve(j,this)}finally{d.close(),d=null,b&&b()}}).src(d.svgBase64Data),{appendTo:function(a){return a.appendChild(j),this},getBase64:function(){var a=null,b=new f,c=arguments;return e.done(function(d,e){try{a=d.toDataURL.apply(d,c)}catch(a){console.log("toDataURL: Failed to convert canvas to base64 image data")}finally{b[a?"resolve":"reject"](a)}}),b},getCanvas:function(){return j}}},window.jHTML2Canvas=d}();