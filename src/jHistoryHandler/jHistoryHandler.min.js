!function(){"use strict";function a(a,b,c){function d(){a.addEventListener("beforeunload",function(a){b.fromState&&(sessionStorage.fromState=b.fromState,sessionStorage.fromParams=JSON.stringify(b.fromParams),sessionStorage._history=JSON.stringify(j));var c={};for(var d in k)c[d]=k[d]();sessionStorage._stack=JSON.stringify(c)}),sessionStorage.fromState&&(b.fromState=sessionStorage.fromState,b.fromParams=JSON.parse(sessionStorage.fromParams),j=JSON.parse(sessionStorage._history),b.refreshState=!0),sessionStorage._stack&&(l=JSON.parse(sessionStorage._stack)),b.$on("$setHistroy",function(a,c){return b.refreshState?void delete b.refreshState:(b.fromState=c.fromState,void(b.fromParams=c.fromParams))}),b.$on("$setPageHistory",function(a,c){g(c.parent);var d=j[c.parent].length-1,e=j[c.parent][d];(!e||e&&e.toState!==b.toState.name)&&j[c.parent].push({name:b.fromState,Param:b.fromParams,toState:b.toState.name})}),sessionStorage.clear()}function e(a){var b=j[a];if(b.length){var d=b.splice(b.length-1,1)[0];return void(d?c.go(d.name,d.Param):history.go(-1))}history.go(-1)}function f(a,c){b.$broadcast(a,c)}function g(a){j[a]||(j[a]=[])}function h(a,b,c){return this.$get=function(a){return l[a]||{}},!(!a||!b)&&(k[a]=b,void(c&&(l[a]=b())))}var i={initialize:d,go:e,$broadcast:f,$setPageState:g,pushStack:h},j={},k={},l={};return b.$go=e,i}jEli.jModule("rpApp").jFactory("historyHandler",a),a.$injector=["$window","$rootModel","$state"]}();